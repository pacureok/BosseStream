<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>App de Audio en Vivo y Chat</title>
    <!-- Enlace a Tailwind CSS para estilos rápidos y responsivos -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Enlace a tu archivo CSS personalizado -->
    <link rel="stylesheet" href="style.css">
    <!-- Fuente Inter de Google Fonts (¡URL CORREGIDA!) -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-100 font-inter antialiased flex items-center justify-center min-h-screen p-4">
    <div class="bg-white rounded-xl shadow-lg p-6 w-full max-w-2xl">
        <h1 class="text-3xl font-bold text-center text-gray-800 mb-6">App de Audio en Vivo y Chat</h1>

        <!-- Sección de Acceso a Sala Privada -->
        <div id="private-access-section" class="mb-6 p-4 bg-blue-50 rounded-lg border border-blue-200">
            <h2 class="text-xl font-semibold text-blue-800 mb-3">Acceso a Sala de Transmisión Privada</h2>
            <p class="text-gray-700 mb-3">Ingresa el código para acceder a la transmisión de voz privada.</p>
            <input type="password" id="access-code-input" placeholder="Código de acceso"
                   class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 mb-3">
            <button id="enter-private-room-btn"
                    class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition duration-300 ease-in-out">
                Ingresar a Sala Privada
            </button>
            <p id="access-message" class="text-sm text-red-600 mt-2 hidden"></p>
        </div>

        <!-- Sección de Transmisión de Audio (Visible solo con código correcto) -->
        <div id="audio-transmission-section" class="hidden mb-6 p-4 bg-green-50 rounded-lg border border-green-200">
            <h2 class="text-xl font-semibold text-green-800 mb-3">Transmisión de Voz</h2>
            <p class="text-gray-700 mb-3">Tu ID de usuario: <span id="user-id-display" class="font-mono text-green-700 break-all"></span></p>
            <p class="text-gray-700 mb-3">
                <span id="share-link-text">Comparte este enlace para que otros se unan:</span>
                <!-- Texto inicial para accesibilidad -->
                <a id="share-link" href="#" class="text-blue-600 hover:underline break-all">Enlace de sala (se generará al iniciar transmisión)</a>
            </p>
            <button id="start-stream-btn"
                    class="w-full bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 transition duration-300 ease-in-out mb-3">
                Iniciar Transmisión de Voz (Como Transmisor)
            </button>
            <button id="stop-stream-btn"
                    class="w-full bg-red-600 text-white py-3 rounded-lg hover:bg-red-700 transition duration-300 ease-in-out hidden">
                Detener Transmisión
            </button>
            <p id="audio-status" class="text-sm text-gray-600 mt-2"></p>

            <!-- Contenedor para audios remotos (oyentes) -->
            <div id="remote-audio-container" class="mt-4 p-3 bg-white rounded-lg border border-gray-300 hidden">
                <h3 class="text-lg font-semibold text-gray-700 mb-2">Audio de Otros Usuarios:</h3>
                <!-- Los elementos <audio> para usuarios remotos se insertarán aquí dinámicamente -->
                <p id="no-remote-audio" class="text-sm text-gray-500">Esperando audio de otros usuarios...</p>
            </div>
        </div>

        <!-- Sección de Chat en Vivo -->
        <div class="p-4 bg-purple-50 rounded-lg border border-purple-200">
            <h2 class="text-xl font-semibold text-purple-800 mb-3">Chat en Vivo</h2>
            <div id="chat-messages" class="h-64 overflow-y-auto bg-white border border-gray-300 rounded-lg p-3 mb-3 text-sm">
                <!-- Los mensajes del chat se insertarán aquí -->
            </div>
            <div class="flex">
                <input type="text" id="chat-input" placeholder="Escribe tu mensaje..."
                       class="flex-grow p-3 border border-gray-300 rounded-l-lg focus:ring-purple-500 focus:border-purple-500">
                <button id="send-chat-btn"
                        class="bg-purple-600 text-white px-6 py-3 rounded-r-lg hover:bg-purple-700 transition duration-300 ease-in-out">
                    Enviar
                </button>
            </div>
            <p id="chat-status" class="text-sm text-gray-600 mt-2"></p>
        </div>
    </div>

    <!-- Firebase SDKs -->
    <script type="module">
        // Importa las funciones necesarias de Firebase SDK
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
        import { getFirestore, collection, addDoc, query, orderBy, onSnapshot, serverTimestamp, FieldValue, doc, setDoc, getDoc, updateDoc, deleteDoc, getDocs } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore.js";
        // Si vas a usar Analytics, también lo importas:
        // import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-analytics.js";


        // Tu configuración de Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyAu7MWQjdQmKSU-0_WEpu0rw4ld4mhwexY",
            authDomain: "bosse-22145.firebaseapp.com",
            projectId: "bosse-22145",
            storageBucket: "bosse-22145.firebasestorage.app",
            messagingSenderId: "164787042932",
            appId: "1:164787042932:web:be30af7b6576f8f0eeaf21",
            measurementId: "G-R7BZBHWP90"
        };

        // Inicializa Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        // Si vas a usar Analytics, lo inicializas:
        // const analytics = getAnalytics(app);

        // Exporta db y las funciones de Firestore para que sean accesibles en script.js
        window.db = db;
        window.collection = collection;
        window.addDoc = addDoc;
        window.query = query;
        window.orderBy = orderBy;
        window.onSnapshot = onSnapshot;
        window.serverTimestamp = serverTimestamp;
        window.FieldValue = FieldValue;
        window.doc = doc;
        window.setDoc = setDoc;
        window.getDoc = getDoc;
        window.updateDoc = updateDoc;
        window.deleteDoc = deleteDoc;
        window.getDocs = getDocs; // Asegúrate de exportar getDocs también
    </script>
    <!-- Enlace a tu archivo JavaScript principal -->
    <script src="script.js"></script>
</body>
</html>
